<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Yo Nutri!</title>

  <!-- Your stylesheet (unchanged) -->
  <link rel="stylesheet" href="login.css" />
  <link rel="stylesheet" href="style.css" />
<!-- Razorpay Checkout Script -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <!-- Fonts / Icons / Bootstrap (kept as in your file) -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
   <style>
    /* ==== STOP horizontal page scroll on all screens ==== */
html, body {
  width: 100%;
  max-width: 100%;
  overflow-x: hidden;       /* fallback */
}
@supports (overflow-x: clip) {
  html, body { overflow-x: clip; }  /* modern browsers */
}

</style>
  <!-- ===== Shop Drawer + Search Bar styles ===== -->
  <style>
    /* predictable sizing */
    *, *::before, *::after { box-sizing: border-box; }

    :root{
      /* drawer placement (JS updates this) */
      --sheet-top: 64px;
      --gutter: 12px;
      --sheet-radius: 16px;
      --ink: #2b1e17;
      --px-per-sec: 120; /* marquee speed variable */
    }

    /* Basic header look (kept light so it doesn't fight your CSS) */
    .yonutri-navbar{
      position: sticky; top: 0; z-index: 999;
      background:#3e2723;
      /* ADDED: smooth hide/show on scroll */
      transition: transform .28s ease;
      will-change: transform;
    }
    /* ADDED: hidden state for header */
    .yonutri-navbar.nav-hide{
      transform: translateY(-110%);
    }

    .navbar-top{
      display:flex; align-items:center; justify-content:space-between;
      padding: 12px 16px;
    }
    .nav-left .shop-link, .nav-right a{ color:#fff; text-decoration:none; }

    /* Search bar (hidden by default) */
    .search-bar {
      position: fixed;
      top: -105px; /* hidden above the page */
      left: 0;
      width: 100%;
      height: 105px;
      background: #fff;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: top 0.35s ease;
      z-index: 2000;
    }
    .search-bar.show { top: 0; }
    .search-bar input {
      width: min(720px, 80%);
      padding: 10px 12px;
      border: 1px solid #000;
      font-size: 16px;
    }
    .close-search {
      font-size: 24px; cursor: pointer; margin-left: 12px; line-height: 1;
    }
  </style>

  <style>
    :root{
      --border:#e9e9e9; --ink:#1f1f1f; --muted:#6f6f6f;
      --accent:#0a7f00; --pill:#121212; --brand:#ffb347;
    }

    /* ===== overlay (brightness removed) ===== */
    .overlay{position:fixed;inset:0;background:transparent;opacity:0;pointer-events:none;transition:.25s;z-index:1190}
    .overlay.show{opacity:1;pointer-events:auto}

    .cart{position:fixed;top:0;right:0;bottom:0;width:392px;max-width:88vw;background:#fff;
      transform:translateX(110%);transition:.3s ease;z-index:1300;display:grid;
      grid-template-rows:auto 1fr auto;border-left:1px solid var(--border)}
    .cart.active{transform:translateX(0)}

    .cart-hd{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
    .cart-title{display:flex;align-items:center;gap:10px;font-weight:800;font-size:16px}
    .cart-close{cursor:pointer;font-size:18px;color:#222}

    .cart-bd{padding:14px 14px 0;overflow:auto;scrollbar-width:none}
    .cart-bd::-webkit-scrollbar{width:0;height:0}

    .c-items{display:flex;flex-direction:column;gap:12px;margin-bottom:12px}
    .c-row{
      display:grid;grid-template-columns:56px 1fr auto;gap:12px;align-items:start;
      background:#fff;border:1px solid #ededed;border-radius:16px;padding:12px;
      box-shadow:0 1px 0 rgba(0,0,0,.03) inset;
    }
    .c-thumb{width:56px;height:56px;object-fit:contain;border-radius:10px;background:#f7f7f7}
    .c-mid{min-width:0}
    .c-title{margin:0;font-size:14px;line-height:1.3;font-weight:800;color:#1f1f1f}
    .c-sub{font-size:12px;color:var(--muted);margin:6px 0 8px}
    .c-right{display:flex;align-items:center;gap:8px}
    .c-prices{display:flex;flex-direction:column;align-items:flex-end;line-height:1.05;min-width:70px}
    .c-price{font-weight:900;font-size:14px;color:#1f1f1f}
    .c-trash{border:none;background:transparent;color:#b5b5b5;width:30px;height:30px;border-radius:8px;cursor:pointer}
    .c-trash:hover{color:#222}

    .qty{display:inline-flex;align-items:center;gap:0;border:1.5px solid #121212;border-radius:9999px;padding:4px;background:#fff;height:34px}
    .qty .dec,.qty .inc{
      border:0;cursor:pointer;height:26px;min-width:32px;border-radius:8px;
      font-weight:900;font-size:16px;display:flex;align-items:center;justify-content:center;
    }
    .qty .dec{background:#efefef;color:#222}
    .qty.is-single .dec{background:#f3f3f3;color:#9a9a9a}
    .qty .count{width:28px;text-align:center;font-weight:700;font-size:14px;color:#1f1f1f}
    .qty .inc{background:#3e2723;color:#fff}

    .cart-section{border-top:1px solid var(--border);margin:14px -14px 0;padding:10px}
    .sec-title{font-weight:800;font-size:14px;margin:0 0 12px}

    .coupon-band{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      border:1px solid #e7efe7;border-radius:14px;padding:14px 16px;background:#fff
    }
    .coupon-left{display:flex;align-items:center;gap:10px}
    .coupon-left .icon{width:22px;height:22px;display:grid;place-items:center;border-radius:999px;background:#e9f7ea;color:#138a00}
    .coupon-text{display:flex;flex-direction:column;line-height:1.2}
    .coupon-main{font-weight:800;color:#138a00;font-size:14px}
    .coupon-sub{font-size:12px;color:#666}
    .coupon-apply{padding:6px 12px;border:1px solid #cfd8cf;border-radius:12px;background:#fff;font-weight:800;font-size:12px;cursor:pointer}
    .applied-row{display:flex;align-items:center;gap:8px;color:#0a7f00;font-weight:700;font-size:13px;margin-top:10px}
    .applied-row i{color:#0a7f00}

    .offers-wrap{border:1px solid var(--border);border-radius:14px;padding:12px;background:#fff}
    .offers-head{font-weight:800;color:#138a00;margin:0 0 10px}
    .offer-list{display:flex;gap:12px;overflow:auto;padding-bottom:6px;scroll-snap-type:x mandatory}
      .offer-card{
    flex:0 0 150px; border:1px solid #e9e9e9; border-radius:14px; padding:10px;
    display:flex; flex-direction:column; gap:8px; background:#fff; 
    scroll-snap-align:start;overflow: visible
  }
  .offer-thumb{ width:100%; aspect-ratio: 1 / 1;   height: auto; display: block;
  padding: 8px; 
     object-fit:contain;
      /* background:#f7f7f7;  */
      border-radius:10px }
     @supports not (aspect-ratio: 1 / 1) {
  .offer-thumb{ height: 120px; }   /* was 76px — give more headroom */
}
    .offer-title{font-size:12px;font-weight:800;line-height:1.2;min-height:32px}
    .offer-price{display:flex;align-items:center;justify-content:space-between;font-size:12px}
    .offer-old{text-decoration:line-through;color:#777}
    .offer-cta,.offer-qty{height:32px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:900;cursor:pointer}
    .offer-cta{border:1px solid #2b8a00;background:#fff}
    .offer-qty{border:1.5px solid #121212;gap:6px;padding:0 4px}
    .offer-qty .dec,.offer-qty .inc{height:26px;min-width:28px;border:0;border-radius:8px;font-weight:900;font-size:14px;display:flex;align-items:center;justify-content:center;cursor:pointer}
    .offer-qty .dec{background:#e9e9e9}
    .offer-qty .inc{background:#16271b;color:#fff}
    .offer-qty .count{min-width:20px;text-align:center;font-weight:800}

    .cart-ft{border-top:1px solid var(--border);background:#fff;padding:12px 14px;display:grid;gap:10px}
    .total-line{display:flex;align-items:center;justify-content:space-between}
    .total-left small{color:#666}
    .checkout{width:100%;background:#FFA500;color:#fff;border:none;border-radius:9999px;padding:12px 16px;font-weight:900;cursor:pointer}

    .cart-badge{position:absolute;top:-6px;right:-8px;min-width:18px;height:18px;padding:0 5px;border-radius:9999px;display:inline-flex;align-items:center;justify-content:center;background:#0a7f00;color:#fff;font-weight:900;font-size:11px;line-height:18px;box-shadow:0 1px 0 rgba(0,0,0,.15)}
    .cart-badge[hidden]{display:none !important}
    @keyframes cb-pop{0%{transform:scale(.6)}50%{transform:scale(1.15)}100%{transform:scale(1)}}
    .cart-badge.pop{animation:cb-pop .28s ease}

    /* ===== DESKTOP SHOP PANEL ===== */
    
    /* Hamburger button */
    .hamburger{ background: none;border:0;font-size:22px;cursor:pointer; }

    /* ===== Shop Drawer (mobile sheet) =============================== */
    :root{
      --sheet-top: 64px;        /* JS will update this to header height */
      --gutter: 12px;           /* side margin on phones */
      --sheet-radius: 16px;
      --ink: #2b1e17;
    }

    /* Drawer container */
    .shop-drawer{
      position: fixed;
      left: var(--gutter);
      right: var(--gutter);
      top: var(--sheet-top);
      width: auto;
      max-width: 420px;
      margin: 0 auto;
      background:#fff;
      border-radius: var(--sheet-radius);
      box-shadow: 0 10px 28px rgba(0,0,0,.18);
      z-index: 1200;

      display:flex;
      flex-direction:column;
      overflow:hidden;

      transform: translateY(calc(-100% - 12px));
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transition:
        transform .32s ease,
        opacity .28s ease,
        visibility 0s linear .32s;
    }
    .shop-drawer.open{
      transform: translateY(0);
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
      transition:
        transform .32s ease,
        opacity .28s ease,
        visibility 0s;
    }

    .shop-drawer-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:12px 14px;
      border-bottom:1px solid #eee;
      background:#fff;
    }
    .shop-drawer-header h4{
      margin:0;
      font:700 13px/1.1 Montserrat, Inter, system-ui;
      letter-spacing:.35px;
      color:var(--ink);
      text-transform:uppercase;
    }
    .shop-drawer-header .fa-xmark{
      cursor:pointer;
      font-size:18px;
      color:var(--ink);
    }

    .shop-drawer-body{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:12px;
      padding:12px 12px 16px;
    }

    .shop-drawer .category-item{
      position:relative;
      display:block;
      min-height:84px;
      padding:12px 76px 12px 12px;
      background:#f3ecdd;
      border:1px solid #e9e0cf;
      border-radius:14px;
      box-shadow:0 1px 0 rgba(0,0,0,.04) inset;
      color:var(--ink);
      text-decoration:none;
      transition:transform .06s ease, background .18s ease;
    }
    .shop-drawer .category-item:hover{ background:#efe6d3; }
    shop-drawer .category-item:active{ transform:scale(.995); }

    .shop-drawer .category-item span{
      display:block;
      font:700 12.5px/1.2 Montserrat, Inter, system-ui;
      color:var(--ink);
      overflow:hidden;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
    }

    .shop-drawer .category-item img{
      position:absolute;
      right:10px;
      bottom:10px;
      width:56px; height:56px;
      object-fit:contain;
      background:#fff;
      border-radius:12px;
      box-shadow:0 2px 6px rgba(0,0,0,.12);
      outline:1px solid #eee;
    }

    /* Overlay (under sheet, above site) — brightness removed */
    .overlay{
      position:fixed;
      inset:0;
      background:transparent;
      opacity:0;
      visibility:hidden;
      pointer-events:none;
      transition:opacity .25s ease, visibility .25s ease;
      z-index:1190;
    }
    .overlay.show{
      opacity:1;
      visibility:visible;
      pointer-events:auto;
    }

    /* Body scroll lock helper */
    html.modal-open, body.modal-open{ height:100%; overflow:hidden; }

    /* Slightly wider gutters on small tablets */
    @media (min-width:480px){
      :root{ --gutter:16px; }
    }
    /* Make sure desktop hamburger stays hidden */
    @media (min-width: 769px){ .hamburger{ display:none !important; } }
    /* Desktop: SHOP text visible, hamburger hidden */
    @media (min-width: 769px) {
      .nav-left .shop-link { display: inline-block; color: #fff; text-decoration: none; }
      .hamburger { display: none; }
    }

    /* Mobile: hamburger visible, SHOP text hidden */
    @media (max-width: 768px) {
      .nav-left .shop-link { display: none; }
      .hamburger { display: inline-block; }
    }

    .hamburger{
      display:inline-block;
      background:none; border:0; cursor:pointer;
      color:#fff;
      text-align:center;
      line-height:1.1;
      font-weight:800;
      font-size:10px;
      letter-spacing:.4px;
      padding:6px 8px;
    }
    .hamburger i{
      display:block;
      font-size:20px;
      line-height:1;
      margin-bottom:3px;
    }

    /* ======== hide the wrong surface per device ======== */
    @media (min-width: 992px){
      .shop-drawer{ display:none !important; }
    }
    @media (max-width: 991.98px){
      .shop-panel{ display:none !important; }
    }
  </style>
</head>
<body>

  <!-- ===== Header ===== -->
  <!-- <header class="yonutri-navbar">
    <div class="navbar-top">
      <div class="nav-left">
      
        <a href="#" class="shop-link" data-shop-trigger><i class="fas fa-arrow-up-right-from-square"></i> SHOP</a>
        <button id="hamburgerBtn" class="hamburger" data-shop-trigger><i class="fas fa-bars"></i>MENU</button>
      </div>
      <div class="nav-center">
        <a href="index.html" class="logo-link">
          <img src="images/WhatsApp Image 2025-08-08 at 9.47.38 AM.jpeg" alt="Yo Nutri Logo" class="nav-logo" />
        </a>
      </div>
      <div class="nav-right">
        <a href="#" class="search-icon"><i class="fa-solid fa-magnifying-glass"></i></a>
        <a href="login.html"><i class="fa-solid fa-user"></i></a>
        <a href="#" id="cartIcon">CART <i class="header-icon fa-solid fa-cart-shopping"></i></a>
      </div>
    </div>
    <div class="search-bar" id="searchBar">
      <input type="text" placeholder="Search" />
      <span class="close-search" id="closeSearch">&times;</span>
    </div>
  </header> -->

  <!-- <div class="shop-panel" id="shopPanel" aria-hidden="true">
    <div class="shop-panel-content">
      <a href="#" class="shop-link"><div class="shop-sidebar"><h5>SHOP BY CATEGORY</h5></div></a>
      <div class="category-grid">
        <a href="index.html" class="shop-link"><div class="category-item"><span>New Launches & Offers</span><img src="images/chocolate1.png" alt=""></div></a>
        <a href="index.html" class="shop-link"><div class="category-item"><span>All Products</span><img src="images/image (2).png" alt=""></div></a>
        <a href="index.html" class="shop-link"><div class="category-item"><span>Protein</span><img src="images/chocolate6.jpg" alt=""></div></a>
        <a href="index.html#love-choco" class="shop-link"><div class="category-item"><span>Bars</span><img src="images/roasted6.jpg" alt=""></div></a>
        <a href="index.html#yo-products" class="shop-link"><div class="category-item"><span>All Peanut Butter</span><img src="images/CREAMY_Dark_Chocolate-removebg-preview.png" alt=""></div></a>
        <a href="index.html#yo-products" class="shop-link"><div class="category-item"><span>Peanut Butter Creamy</span><img src="images/CREAMY_Dates-removebg-preview.png" alt=""></div></a>
        <a href="index.html#yo-producrs" class="shop-link"><div class="category-item"><span>Peanut Butter Crunchy</span><img src="images/CRUNCHY_Dark_Chocolate-removebg-preview.png" alt=""></div></a>
        <a href="index.html#yo-products" class="shop-link"><div class="category-item"><span>Protein Bundle</span><img src="images/chocolate7.jpg" alt=""></div></a>
      </div>
    </div>
  </div> -->

  <!-- Shop Drawer -->
  <!-- <aside class="shop-drawer" id="shopDrawer" aria-hidden="true">
    <div class="shop-drawer-header">
      <h4>SHOP BY CATEGORY</h4>
      <i class="fa-solid fa-xmark" id="closeShopDrawer"></i> 
    </div>
    <div class="shop-drawer-body">
      <a href="#yn-love" class="category-item">
        <img src="images/image (1).png" alt="">
        <span>New Launches & Offers</span>
      </a>
      <a href="" class="category-item">
        <img src="images/image (2).png" alt="">
        <span>All Products</span>
      </a>
      <a href="" class="category-item">
        <img src="images/chocolate6.jpg" alt="">
        <span>Protein</span>
      </a>
      <a href="#yn-love" class="category-item">
        <img src="images/roasted6.jpg" alt="">
        <span>Bars</span>
      </a>
      <a href="#yn-love" class="category-item">
        <span>All Peanut Butter</span><img src="images/CREAMY_Dark_Chocolate-removebg-preview.png" alt="">
      </a>
      <a href="##yn-love" class="category-item">
        <span>Protein Bundle</span><img src="images/chocolate7.jpg" alt="">
      </a>
      <a href="#yn-love" class="category-item"><span>Peanut Butter Creamy</span>
        <img src="images/CREAMY_Dates-removebg-preview.png" alt=""></a>
      <a href="#yo-products" class="category-item"><span>Peanut Butter Crunchy</span>
        <img src="images/CRUNCHY_Dark_Chocolate-removebg-preview.png" alt=""></a>
    </div>
  </aside> -->

  <!-- Single Overlay -->
  <!-- <div class="overlay" id="overlay" tabindex="-1" aria-hidden="true"></div> -->

  <!-- <aside class="cart" id="cart">
    <div class="cart-hd">
      <div class="cart-title"><i class="fa-solid fa-cart-shopping"></i><span id="cartTitle">Your cart · 0 item</span></div>
      <i class="fa-solid fa-xmark cart-close" id="closeCart" title="Close"></i>
    </div>

    <div class="cart-bd">
      <div class="c-items" id="cartItems"></div>

      <div class="cart-section">
        <div class="sec-title">Offers & Rewards</div>

        <div id="dynamicCouponsList"></div>

        <div id="appliedRow" class="applied-row" style="display:none">
          <i class="fa-regular fa-circle-check"></i>
          <span><span id="appliedSavings">₹0</span> total savings · 1 applied</span>
          <button id="removeCouponBtn" class="coupon-apply" type="button">Remove</button>
        </div>
      </div>

      <div class="cart-section">
        <div class="offers-wrap">
          <div class="offers-head">Special Offers For You</div>
          <div class="offer-list" id="offerList"></div>
        </div>
        <label class="applied-row" style="margin-top:10px;color:#444;font-weight:600">
          <input type="checkbox" checked style="accent-color:#0a7f00;margin-right:8px"> Keep me posted about sales and offers
        </label>
      </div>
    </div>

    <div class="cart-ft">
      <div class="total-line">
        <div class="total-left">
          <strong id="totalRupees">₹0</strong>
          <small>Estimated total</small>
        </div>
      </div>
      <button id="checkoutBtn" class="checkout" type="button">Checkout</button>
    </div>
  </aside> -->


 <!-- Header -->
  <header class="yonutri-navbar">
    <div class="navbar-top">
      <div class="nav-left">
        <a href="#" class="shop-link"><i class="fas fa-arrow-up-right-from-square"></i> SHOP</a>
        <button id="hamburgerBtn" class="hamburger"><i class="fas fa-bars"></i>MENU</button>

      </div>
      <div class="nav-center">
        <a href="index.html" class="logo-link" class="protect-copy">
          <img src="images/WhatsApp Image 2025-08-08 at 9.47.38 AM.jpeg" alt="Yo Nutri Logo" class="nav-logo protect-copy" />
        </a>
      </div>
      <div class="nav-right">
        <a href="#" class="search-icon"><i class="fa-solid fa-magnifying-glass"></i></a>
                <a href="login.html" id="userIcon"><i class="fa-solid fa-user"></i></a>

        <a href="#" id="cartIcon">CART <i class="header-icon fa-solid fa-cart-shopping"></i></a>
      </div>
    </div>
    <!-- hidden search -->
    <div class="search-bar" id="searchBar">
      <input type="text" placeholder="Search" />
      <span class="close-search" id="closeSearch">&times;</span>
    </div>
  </header>

  

<!-- ===== Shop hidden panel (unchanged) ===== -->
<div class="shop-panel" id="shopPanel">
  <div class="shop-panel-content">
    <a href="#" class="shop-link"><div class="shop-sidebar"><h5>SHOP BY CATEGORY</h5></div></a>
    <div class="category-grid" >
      <a href="index.html" class="shop-link">
        <div class="category-item" class="protect-copy"><span>New Launches & Offers</span><img src="images/chocolate1.png" alt="image" class="protect-copy"></div>
      </a>
      <a href="index.html" class="shop-link" >
        <div class="category-item" class="protect-copy"><span>All Products</span><img src="images/image (2).png" alt="image" class="protect-copy"></div>
      </a>
      <a href="index.html" class="shop-link" >
        <div class="category-item" class="protect-copy"><span>Protein</span><img src="images/chocolate6.jpg" alt="image" class="protect-copy"></div>
      </a>
      <a href="#love-choco" class="shop-link" class="protect-copy"><div class="category-item" class="protect-copy"><span>Bars</span><img src="images/roasted6.jpg" alt="image" class="protect-copy"></div></a>
      <a href="#yo-products" class="shop-link" class="protect-copy"><div class="category-item"><span>All Peanut Butter</span><img src="images/CREAMY_Dark_Chocolate-removebg-preview.png" alt="image" class="protect-copy"></div></a>
      <a href="#yo-products" class="shop-link" class="protect-copy"><div class="category-item"><span>Peanut Butter Creamy</span><img src="images/CREAMY_Dates-removebg-preview.png" alt="image" class="protect-copy"></div></a>
      <a href="#crunchy" class="shop-link" class="protect-copy"><div class="category-item"><span>Peanut Butter Crunchy</span><img src="images/CRUNCHY_Dark_Chocolate-removebg-preview.png" alt="image" class="protect-copy"></div></a>
      <a href="#yo-products" class="shop-link" class="protect-copy"><div class="category-item"><span>Protein Bundle</span><img src="images/chocolate7.jpg" alt="image" class="protect-copy"></div></a>
    </div>
  </div>
</div>


<!-- Shop Drawer -->
<aside class="shop-drawer" id="shopDrawer">
  <div class="shop-drawer-header">
    <h4>SHOP BY CATEGORY</h4>
    <i class="fa-solid fa-xmark" id="closeShopDrawer"></i> 
  </div>
  <div class="shop-drawer-body">
    <a href="#yn-love" class="category-item" class="protect-copy">
      <img src="images/image (1).png" alt="">
      <span>New Launches & Offers</span>
    </a>
    <a href="" class="category-item" class="protect-copy">
      <img src="images/image (2).png" alt="">
      <span>All Products</span>
    </a>
    <a href="" class="category-item" class="protect-copy">
      <img src="images/chocolate6.jpg" alt="">
      <span>Protein</span>
    </a>
    <a href="#yn-love" class="category-item" class="protect-copy">
      <img src="images/roasted6.jpg" alt="">
      <span>Bars</span>
    </a>
    <a href="#yo-products" class="category-item" class="protect-copy">
      <span>All Peanut Butter</span><img src="images/CREAMY_Dark_Chocolate-removebg-preview.png" alt="">
    </a>
    <a href="#yo-products" class="category-item" class="protect-copy">
      <span>Protein Bundle</span><img src="images/chocolate7.jpg" alt="">
    </a>
    <a href="#yo-products" class="category-item" class="protect-copy"><span>Peanut Butter Creamy</span>
      <img src="images/CREAMY_Dates-removebg-preview.png" alt=""></a>
        <a href="#crunchy" class="category-item" class="protect-copy"><span>Peanut Butter Crunchy</span>
          <img src="images/CRUNCHY_Dark_Chocolate-removebg-preview.png" alt=""></a>
    <!-- ... repeat categories ... -->
  </div>
</aside>
<!-- Overlay (ADD THIS) -->
<div class="overlay" id="overlay" tabindex="-1" aria-hidden="true"></div>

<!-- ===== Overlay for cart ===== -->
<div class="overlay" id="overlay"></div>

 <!-- Cart Drawer -->
  <aside class="cart" id="cart">
    <div class="cart-hd">
      <div class="cart-title"><i class="fa-solid fa-cart-shopping"></i><span id="cartTitle">Your cart · 0 item</span></div>
      <i class="fa-solid fa-xmark cart-close" id="closeCart" title="Close"></i>
    </div>
    <div class="cart-bd">
      <div class="c-items" id="cartItems"></div>

      <div class="cart-section">
        <div class="sec-title">Apply Coupon</div>
        <div class="coupon-form" style="display: flex; gap: 10px;">
          <input type="text" id="couponInput" placeholder="Enter coupon code" style="flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 8px;">
          <button id="applyCouponBtn" class="coupon-apply" type="button">Apply</button>
        </div>
        <div id="couponMessage" style="margin-top: 10px; color: red; font-size: 12px;"></div>

        <div id="appliedRow" class="applied-row" style="display:none">
          <i class="fa-regular fa-circle-check"></i>
          <span><span id="appliedSavings">₹0</span> total savings</span>
          <button id="removeCouponBtn" class="coupon-apply" type="button">Remove</button>
        </div>
      </div>

      <div class="cart-section">
        <div class="sec-title">Available Coupons</div>
        <div id="couponScroller" style="display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px;">
          <!-- Coupons will be dynamically inserted here -->
        </div>
      </div>

      <div class="cart-section">
        <div class="offers-wrap">
          <div class="offers-head">Special Offers For You</div>
          <div class="offer-list" id="offerList"></div>
        </div>
        <label class="applied-row" style="margin-top:10px;color:#444;font-weight:600">
          <input type="checkbox" checked style="accent-color:#0a7f00;margin-right:8px"> Keep me posted about sales and offers
        </label>
      </div>
    </div>

    <div class="cart-ft">
      <div class="total-line">
        <div class="total-left">
          <strong id="totalRupees">₹0</strong>
          <small>Estimated total</small>
        </div>
      </div>
      <a href="checkout.html">

       <button id="checkoutBtn" class="checkout" type="button">Checkout</button>
      </a>
      
      
    </div>
  </aside>

  <!-- ===== Login section (unchanged) ===== -->
  <div class="form-container" style="padding: 40px 20px; max-width: 400px; margin: auto; width: 100%; box-sizing: border-box;">
    <!-- LOGIN FORM -->
    <form id="loginForm">
      <h1>Login</h1>
      <input type="email" placeholder="Email" required>
      <input type="password" placeholder="Password" required minlength="6">
      <a href="#" onclick="showForm('resetForm')">Forgot your password?</a><br>
      <button type="submit">Sign in</button>
      <br><br>
      <a href="#" onclick="showForm('createForm')">Create account</a>
    </form>

    <!-- RESET PASSWORD FORM -->
    <form id="resetForm" class="hidden">
      <h1>Reset your password</h1>
      <p>We will send you an email to reset your password</p>
      <input type="email" id="resetEmail" placeholder="Email" required>
      <button type="submit">Send Reset Code</button>
      <button type="button" onclick="showForm('loginForm')" style="background:#ccc; color:#000;">Cancel</button>
    </form>

    <!-- ENTER CODE FORM -->
    <form id="codeForm" class="hidden">
      <h1>Enter Reset Code</h1>
      <p>Enter the 6-digit code sent to your email and phone</p>
      <input type="text" id="resetCode" placeholder="Enter 6-digit code" maxlength="6" required>
      <input type="password" id="newPassword" placeholder="New password" minlength="6" required>
      <button type="submit">Reset Password</button>
      <button type="button" onclick="showForm('resetForm')" style="background:#ccc; color:#000;">Back</button>
    </form>

    <!-- CREATE ACCOUNT FORM -->
    <form id="createForm" class="hidden">
      <h1>Create account</h1>
      <input type="text" placeholder="First name" pattern="[A-Za-z]+" required>
      <input type="text" placeholder="Last name" pattern="[A-Za-z]+" required>
      <input type="tel" placeholder="Phone" pattern="[0-9]{10}" required>
      <input type="email" placeholder="Email" required>
      <input type="password" placeholder="Password" required minlength="6">
      <button type="submit">Create</button>
      <br><br>
      <a href="#" onclick="showForm('loginForm')">Back to Login</a>
    </form>

    

      

<!-- ADDRESSES PAGE SECTION -->
<!-- ACCOUNT PAGE SECTION -->
<div id="accountPage" class="hidden">
  <div class="account-wrapper">
    <!-- LEFT -->
    <div class="account-left">
      <h1>Account</h1>
      <p>
        <i class="fa-regular fa-user"></i>
        <a href="#" id="logoutBtn">Log out</a>
      </p>

      <h2 style="margin-top:30px;">Order history</h2>
      <p style="color:#555;">
        You haven't placed any orders yet.
      </p>
    </div>

    
    <div class="account-right">
      <h2>Account details</h2>
      <p id="accountName"></p>
      <p>India</p>
      <a href="#" id="viewAddressesBtn" style="color:#555; text-decoration:none;">View addresses (1)</a>
    </div>
  </div>
</div>

<!-- ADDRESSES PAGE SECTION -->
<div id="addressesPage" class="hidden">
  <h1>Addresses</h1>
  <a href="#" id="returnAccountBtn">Return to Account details</a>
  <br />
  <br />
  <button
    type="button"
    id="addAddressBtn"
    style="background:#111; color:#fff; padding:10px 20px; border:none;"
  >
    Add a new address
  </button>

 

  <!-- ADD ADDRESS FORM -->
  <form id="addressForm" class="hidden" style="max-width: 500px; margin-top: 20px;">
    <h2>Add a new address</h2>

    <input
      type="text"
      name="first_name"
      placeholder="First Name"
      style="width: 100%; margin-top: 1rem"
    />

    <input
      type="text"
      name="last_name"
      placeholder="Last Name"
      style="width: 100%; margin-top: 1rem"
    />

    <input
      type="tel"
      name="phone"
      placeholder="Phone Number"
      style="width: 100%; margin-top: 1rem"
    />

    <input
      type="text"
      name="address"
      placeholder="Address"
      required
      style="width: 100%; margin-top: 1rem"
    />

    <input
      type="text"
      name="city"
      placeholder="City"
      required
      style="width: 100%; margin-top: 1rem"
    />

    <input
      type="text"
      name="state"
      placeholder="State"
      required
      style="width: 100%; margin-top: 1rem"
    />

    <input
      type="text"
      name="pincode"
      placeholder="Postal/ZIP code"
      required
      style="width: 100%; margin-top: 1rem"
    />
    <label style="display: block; margin-top: 1rem">
      <input type="checkbox" name="is_default" style="margin-right: 0.5rem" />
      Set as default address
    </label>
    <br />
    <!-- <button
      type="submit"
      style="background: #111; color: #fff; padding: 10px 20px; margin-top: 1rem"
    >
      Add address
    </button>
    <button type="button" id="cancelAddressBtn" style="margin-left: 1rem">
      Cancel
    </button> -->
    <div class="form-btn-row">
    <button type="submit" style="background:#111; color:#fff; margin-top: 1rem;">Add address</button>
    <button type="button" id="cancelAddressBtn">Cancel</button>
  </div>
  </form>
  <!-- Address List (always visible) -->
<div id="addressList">
  <h2>Default</h2>
  <p><br>India</p>
  <a href="#" id="editAddressBtn" style="margin-right:2rem;">Edit</a>
  <a href="#">Delete</a>
</div>

<!-- Edit Address Form (hidden by default) -->
<form id="editAddressForm" class="hidden" style="max-width: 500px; margin-top: 20px;">
  <h2>Edit address</h2>

  <input type="text" name="first_name" placeholder="First Name" style="width: 100%; margin-top: 1rem;" />

  <input type="text" name="last_name" placeholder="Last Name" style="width: 100%; margin-top: 1rem;" />

  <input type="tel" name="phone" placeholder="Phone Number" style="width: 100%; margin-top: 1rem;" />

  <input type="text" name="address" placeholder="Address" required style="width: 100%; margin-top: 1rem;" />

  <input type="text" name="city" placeholder="City" required style="width: 100%; margin-top: 1rem;" />

  <input type="text" name="state" placeholder="State" required style="width: 100%; margin-top: 1rem;" />

  <input type="text" name="pincode" placeholder="Postal/ZIP code" required style="width: 100%; margin-top: 1rem;" />

  <label style="display: block; margin-top: 1rem;">
    <input type="checkbox" name="is_default" style="margin-right: 0.5rem;" />
    Set as default address
  </label>
  <br />
 <div class="form-btn-row">
    <button type="submit" style="background:#111; color:#fff; margin-top: 1rem;">Add address</button>
    <button type="button" id="cancelAddressBtn">Cancel</button>
  </div>
</form>
</div>





  </div>

  <!-- ===== Footer (unchanged except trigger attribute) ===== -->
  <footer class="custom-footer">
    <div class="footer-wrapper">
      <div class="footer-column logo-column">
        <div class="logo-circle">
          <img src="images/WhatsApp Image 2025-08-08 at 9.47.38 AM.jpeg" alt="Yo! Nutri Logo">
        </div>
        <p>WE’RE A NUTRITION-LED FOOD COMPANY THAT PRIDES ITSELF IN MAKING TASTY AND SIMPLE FOOD THAT’S GOOD FOR YOU. ALL WITHOUT ANY ARTIFICIAL COLOURS, CHEMICALS OR PRESERVATIVES. WE ONLY USE INGREDIENTS YOU CAN SEE AND TASTE. AND THAT’S WHY WE LET THEM DO THE TALKING.<br>GO ON AND TRY SOME!</p>
        <div class="social-icons">
          <a href="https://www.instagram.com/yonutri2024?igsh=amloYjAyaDNkOXpw"><i class="fab fa-instagram"></i></a>
          <a href="https://www.linkedin.com/company/yo-nutri-foods/?originalSubdomain=in"><i class="fab fa-linkedin-in"></i></a>
          <a href="#"><i class="fab fa-facebook-f"></i></a>
          <a href="#"><i class="fab fa-youtube"></i></a>
        </div>
      </div>

      <div class="footer-column">
        <!-- Clicking this opens SHOP -->
        <h4 data-shop-trigger style="cursor:pointer;">SHOP</h4>
        <ul>
          <li><a href="index.html">ALL PRODUCTS</a></li>
          <li><a href="index.html">NEW LAUNCHES & OFFERS</a></li>
          <li><a href="index.html#yo-products">PROTEIN</a></li>
          <li><a href="Index.html#love-choco">BARS</a></li>
        </ul>
      </div>

      <div class="footer-column">
        <h4>QUICK LINKS</h4>
        <ul>
          <li><a href="ship.html">SHIPPING & DELIVERY</a></li>
          <li><a href="terms and conditions.html">TERMS AND CONDITIONS</a></li>
          <li><a href="privacy.html">PRIVACY POLICY</a></li>
        </ul>
      </div>

      <div class="footer-column">
        <h4>CONTACT US</h4>
        <p>PH: <a href="tel:+917386120893" style="color:aliceblue;">+91-7386120893</a></p>
        <p>AVAILABLE MON TO FRI : 10 AM – 6 PM</p>
        <p>EMAIL: <a href="mailto:listen@yonutri.com" style="color: aliceblue;">listen@yonutri.com</a></p>
        <p>WE TRY TO RESPOND WITHIN 48 HOURS.</p>
      </div>

      <div class="footer-column">
        <h4>OUR STORY</h4>
        <ul><li><a href="our story.html">WHY WE EXIST?</a></li></ul>
      </div>
    </div>
    <hr><p class="quote">WE LET OUR INGREDIENTS DO THE TALKING!</p><hr>
    <div class="footer-bottom"><p>&copy; 2025 Yo! Nutri.</p></div>
  </footer>

  <!-- ===== Marquee (unchanged) ===== -->
  <section class="marquee-alt" id="marqueeAlt">
    <div class="marquee-alt__track" id="trackAlt">
      <div class="marquee-alt__content" id="contentAlt">
        <span>IT’S SIMPLE UNTIL YOU MAKE IT COMPLICATED</span>
        <span>WE MAKE HEALTHY EASY</span>
        <span>WE BELIEVE IN KEEPING IT SIMPLE</span>
      </div>
    </div>
  </section>

  <!-- ===== Page scripts (login + marquee) ===== -->
   
<script src="./config.js">

</script>

<script>
function showAddressesPage() {
    document.getElementById('accountPage').classList.add('hidden');
    document.getElementById('addressesPage').classList.remove('hidden');
}

function showAccountPage() {
    document.getElementById('addressesPage').classList.add('hidden');
    document.getElementById('accountPage').classList.remove('hidden');
}


// Attach to "View addresses"
document.querySelector('.account-right a').addEventListener('click', function(e) {
    e.preventDefault();
    showAddressesPage();
});

// Attach to "Return to Account details"
document.querySelector('#addressesPage a').addEventListener('click', function(e) {
    e.preventDefault();
    showAccountPage();
});

</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const accountPage = document.getElementById("accountPage");
    const addressesPage = document.getElementById("addressesPage");
    const addressList = document.getElementById("addressList");
    const addressForm = document.getElementById("addressForm");
    const editAddressForm = document.getElementById("editAddressForm");

    // Show Addresses page
    document
      .getElementById("viewAddressesBtn")
      .addEventListener("click", function (e) {
        e.preventDefault();
        accountPage.classList.add("hidden");
        addressesPage.classList.remove("hidden");
        addressList.classList.remove("hidden");
        addressForm.classList.add("hidden");
        loadUserAddresses(); // Load addresses when page is shown
      });

    // Return to Account details
    document
      .getElementById("returnAccountBtn")
      .addEventListener("click", function (e) {
        e.preventDefault();
        addressesPage.classList.add("hidden");
        accountPage.classList.remove("hidden");
      });

    // Show Add Address form
    document.getElementById('addAddressBtn').addEventListener('click', function() {
      resetAddressForm();
      document.getElementById('addressForm').classList.remove('hidden');
    });

    // Cancel new address form
    document.getElementById('cancelAddressBtn').addEventListener('click', function() {
      document.getElementById('addressForm').classList.add('hidden');
      resetAddressForm();
    });

    // Cancel edit address form
    document.getElementById('cancelEditAddressBtn').addEventListener('click', function() {
      document.getElementById('editAddressForm').classList.add('hidden');
      resetEditAddressForm();
    });

    // Handle add address form submit
    addressForm.addEventListener("submit", function (e) {
      e.preventDefault();
      addNewAddress();
    });

    // Handle edit address form submit
    editAddressForm.addEventListener("submit", function (e) {
      e.preventDefault();
      updateAddress();
    });

    // Load user addresses
    async function loadUserAddresses() {
      const token = localStorage.getItem('token');
      if (!token) {
        alert('Please login first');
        return;
      }

      try {
        const response = await fetch(`${API}/api/user/addresses`, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json',
          },
        });

        const data = await response.json();

        if (response.ok) {
          renderAddressList(data);
        } else {
          alert(data.message || 'Failed to load addresses');
        }
      } catch (error) {
        console.error('Load addresses error:', error);
        alert('Failed to load addresses. Please try again.');
      }
    }

    // Render address list
    function renderAddressList(addresses) {
      const addressList = document.getElementById('addressList');

      if (addresses.length === 0) {
        addressList.innerHTML = '<p>No addresses found. Add a new address to get started.</p>';
        return;
      }

      let html = '<h2>Default</h2>';
      addresses.forEach(address => {
        html += `
          <div class="address-item" data-id="${address.id}">
            <p><strong>${address.first_name} ${address.last_name}</strong><br>
            ${address.address}<br>
            ${address.city}, ${address.state} - ${address.pincode}<br>
            Phone: ${address.phone}</p>
            <div class="address-actions">
              <a href="#" class="edit-address-btn" data-id="${address.id}">Edit</a>
              <a href="#" class="delete-address-btn" data-id="${address.id}">Delete</a>
            </div>
          </div>
        `;
      });

      addressList.innerHTML = html;

      // Add event listeners for edit and delete buttons
      document.querySelectorAll('.edit-address-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          const addressId = this.getAttribute('data-id');
          editAddress(addressId);
        });
      });

      document.querySelectorAll('.delete-address-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          const addressId = this.getAttribute('data-id');
          deleteAddress(addressId);
        });
      });
    }

    // Add new address
    async function addNewAddress() {
      const token = localStorage.getItem('token');
      if (!token) {
        alert('Please login first');
        return;
      }

      const form = document.getElementById('addressForm');
      const formData = new FormData(form);
      const addressData = {
        first_name: formData.get('first_name') || '',
        last_name: formData.get('last_name') || '',
        phone: formData.get('phone') || '',
        address: formData.get('address'),
        city: formData.get('city'),
        state: formData.get('state'),
        pincode: formData.get('pincode'),
        is_default: formData.get('is_default') === 'on'
      };

      // Validate required fields
      if (!addressData.address || !addressData.city || !addressData.state || !addressData.pincode) {
        alert('Please fill in all required fields');
        return;
      }

      try {
        const response = await fetch(`${API}/api/user/addresses`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(addressData)
        });

        const data = await response.json();

        if (response.ok) {
          alert('Address added successfully!');
          document.getElementById('addressForm').classList.add('hidden');
          resetAddressForm();
          loadUserAddresses(); // Reload addresses
        } else {
          alert(data.message || 'Failed to add address');
        }
      } catch (error) {
        console.error('Add address error:', error);
        alert('Failed to add address. Please try again.');
      }
    }

    // Edit address
    async function editAddress(addressId) {
      const token = localStorage.getItem('token');
      if (!token) {
        alert('Please login first');
        return;
      }

      try {
        const response = await fetch(`${API}/api/user/addresses`, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json',
          },
        });

        const addresses = await response.json();

        if (response.ok) {
          const address = addresses.find(addr => addr.id == addressId);
          if (address) {
            populateEditForm(address);
            document.getElementById('editAddressForm').classList.remove('hidden');
          } else {
            alert('Address not found');
          }
        } else {
          alert('Failed to load address for editing');
        }
      } catch (error) {
        console.error('Edit address error:', error);
        alert('Failed to load address for editing. Please try again.');
      }
    }

    // Update address
    async function updateAddress() {
      const token = localStorage.getItem('token');
      if (!token) {
        alert('Please login first');
        return;
      }

      const form = document.getElementById('editAddressForm');
      const formData = new FormData(form);
      const addressData = {
        first_name: formData.get('first_name') || '',
        last_name: formData.get('last_name') || '',
        phone: formData.get('phone') || '',
        address: formData.get('address'),
        city: formData.get('city'),
        state: formData.get('state'),
        pincode: formData.get('pincode'),
        is_default: formData.get('is_default') === 'on'
      };

      // Validate required fields
      if (!addressData.address || !addressData.city || !addressData.state || !addressData.pincode) {
        alert('Please fill in all required fields');
        return;
      }

      try {
        const response = await fetch(`${API}/api/user/addresses/${localStorage.getItem('userId') || 'default'}`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(addressData)
        });

        const data = await response.json();

        if (response.ok) {
          alert('Address updated successfully!');
          document.getElementById('editAddressForm').classList.add('hidden');
          resetEditAddressForm();
          loadUserAddresses(); // Reload addresses
        } else {
          alert(data.message || 'Failed to update address');
        }
      } catch (error) {
        console.error('Update address error:', error);
        alert('Failed to update address. Please try again.');
      }
    }

    // Delete address
    async function deleteAddress(addressId) {
      if (!confirm('Are you sure you want to delete this address?')) {
        return;
      }

      const token = localStorage.getItem('token');
      if (!token) {
        alert('Please login first');
        return;
      }

      try {
        const response = await fetch(`${API}/api/user/addresses/${localStorage.getItem('userId') || 'default'}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json',
          },
        });

        const data = await response.json();

        if (response.ok) {
          alert('Address deleted successfully!');
          loadUserAddresses(); // Reload addresses
        } else {
          alert(data.message || 'Failed to delete address');
        }
      } catch (error) {
        console.error('Delete address error:', error);
        alert('Failed to delete address. Please try again.');
      }
    }

    // Populate edit form with address data
    function populateEditForm(address) {
      const form = document.getElementById('editAddressForm');
      const inputs = form.querySelectorAll('input');

      inputs.forEach(input => {
        const name = input.name || input.placeholder.toLowerCase().replace(' ', '_');
        if (address[name]) {
          input.value = address[name];
        }
      });

      // Set checkbox
      const checkbox = form.querySelector('input[type="checkbox"]');
      if (checkbox) {
        checkbox.checked = address.is_default || false;
      }
    }

    // Reset address form
    function resetAddressForm() {
      const form = document.getElementById('addressForm');
      form.reset();
    }

    // Reset edit address form
    function resetEditAddressForm() {
      const form = document.getElementById('editAddressForm');
      form.reset();
    }
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
  const editBtn = document.getElementById("editAddressBtn");
  const editForm = document.getElementById("editAddressForm");
  const cancelEditBtn = document.getElementById("cancelEditAddressBtn");

  editBtn.addEventListener("click", function (e) {
    e.preventDefault();
    editForm.classList.remove("hidden");
  });

  cancelEditBtn.addEventListener("click", function () {
    editForm.classList.add("hidden");
  });

  // Optional: handle the form submit
  editForm.addEventListener("submit", function (e) {
    e.preventDefault();
    // Save logic here...
    editForm.classList.add("hidden");
  });
});

</script>



<script>
  const API = window.ENV.BACKEND_API
console.log(API);
console.log("API URL:", API);

    function showForm(formId) {
      document.querySelectorAll('.form-container form').forEach(form => {
        form.classList.add('hidden');
      });
      document.getElementById(formId).classList.remove('hidden');
      document.getElementById('accountPage').classList.add('hidden');
    }

    // CREATE ACCOUNT
    document.getElementById('createForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const firstName = this.querySelector('input[placeholder="First name"]').value;
      const lastName = this.querySelector('input[placeholder="Last name"]').value;
      const phone = this.querySelector('input[placeholder="Phone"]').value;
      const email = this.querySelector('input[placeholder="Email"]').value;
      const password = this.querySelector('input[placeholder="Password"]').value;
console.log(API);
      try {
        console.log(API);
        const response = await fetch(`${API}/api/register`, {
          
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          
          body: JSON.stringify({
            first_name: firstName,
            last_name: lastName,
            phone: phone,
            email: email,
            password: password
          })
          
        });

        const data = await response.json();

        if (response.ok) {
          localStorage.setItem('token', data.token); // The token contains the user ID
          localStorage.setItem('userName', data.user.first_name + " " + data.user.last_name);
          localStorage.setItem('userId', data.user.id); // Save the user ID
          localStorage.setItem('userEmail', email);
          this.reset();
          showAccountPage();
          
        } else {
          alert(data.message || 'Registration failed');
          
        }
        
      } catch (error) {
        console.error('Registration error:', error);
        alert('Registration failed. Please try again.');
      }
      
    });

    // RESET PASSWORD - Send code
    document.getElementById('resetForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const email = document.getElementById('resetEmail').value;

      try {
        const response = await fetch(`${API}/api/forgot-password`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ email })
          
        });

        const data = await response.json();

        if (response.ok) {
          alert("📧 A verification code has been sent to your email and phone (if available).");
          showForm('codeForm');
          
        } else {
          alert(data.message || 'Failed to send reset code');
          
        }
      } catch (error) {
        console.error('Reset password error:', error);
        
        alert('Failed to send reset code. Please try again.');
      }
    });

    // ENTER CODE AND RESET PASSWORD
    document.getElementById('codeForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const email = document.getElementById('resetEmail').value;
      const code = document.getElementById('resetCode').value;
      const newPassword = document.getElementById('newPassword').value;

      try {
        const response = await fetch(`${API}/api/reset-password`, {
          
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          
          body: JSON.stringify({ email, code, newPassword })
        });

        const data = await response.json();

        if (response.ok) {
          alert("✅ Password reset successful! You can now log in with your new password.");
          this.reset();
          showForm('loginForm');
        } else {
          alert(data.message || 'Failed to reset password');
        }
      } catch (error) {
        console.error('Reset password error:', error);
        alert('Failed to reset password. Please try again.');
      }
    });

    // LOGIN (with admin check)
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const email = this.querySelector('input[placeholder="Email"]').value;
      const password = this.querySelector('input[placeholder="Password"]').value;

      // First try admin login
      try {
        const adminResponse = await fetch(`${API}/api/admin/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ email, password })
          
        });

        const adminData = await adminResponse.json();

        if (adminResponse.ok) {
          localStorage.setItem('token', adminData.token);
          localStorage.setItem('isAdmin', 'true');
          window.location.href = "admin/index.html";
          return;
        }
      } catch (error) {
        console.error('Admin login attempt failed:', error);
        // Continue to regular user login
      }

      // If admin login failed, try regular user login
      try {
        console.log(API);
        const response = await fetch(`${API}/api/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ email, password })
        });

        const data = await response.json();

        if (response.ok) {
          localStorage.setItem('token', data.token); // The token contains the user ID
          localStorage.setItem('userName', data.user.first_name + " " + data.user.last_name);
          localStorage.setItem('userId', data.user.id);
          localStorage.setItem('userEmail', email);
          this.reset();
          showAccountPage();
        } else {
          alert(data.message || 'Login failed');
        }
      } catch (error) {
        console.error('Login error:', error);
        alert('Login failed. Please try again.');
      }
    });

    // LOGOUT
    document.getElementById('logoutBtn').addEventListener('click', function(e) {
      e.preventDefault();
      localStorage.removeItem('token');
      localStorage.removeItem('userName');
      localStorage.removeItem('isAdmin');
      window.location.href = 'index.html';
    });

    function showAccountPage() {
      document.querySelectorAll('.form-container form').forEach(form => form.classList.add('hidden'));
      document.getElementById('accountName').textContent = localStorage.getItem('userName');
      document.getElementById('accountPage').classList.remove('hidden');
    }
  </script>

  <script>
    /* Marquee (bottom) */
    (() => {
      const container = document.getElementById('marqueeAlt');
      const track     = document.getElementById('trackAlt');
      const content   = document.getElementById('contentAlt');
      if (!container || !track || !content) return;

      function setup(){
        [...track.children].forEach((el,i)=>{ if(i) el.remove(); });
        const blockWidth = content.scrollWidth;
        let totalWidth = blockWidth;
        while (totalWidth < container.clientWidth + blockWidth * 2) {
          track.appendChild(content.cloneNode(true));
          totalWidth += blockWidth;
        }
        track.style.setProperty('--shift', blockWidth + 'px');
        const styles = getComputedStyle(document.documentElement);
        const pps = parseFloat(styles.getPropertyValue('--px-per-sec')) || 120;
        const seconds = Math.max(6, blockWidth / pps);
        track.style.setProperty('--duration', seconds + 's');
      }

      const init = ()=>setup();
      if (document.fonts?.ready) document.fonts.ready.then(init);
      init();
      window.addEventListener('resize', setup);
    })();
  </script>

  <!-- ===== Search Bar toggle ===== -->
  <script>
    (function SearchBar(){
      const searchIcon = document.querySelector('.search-icon');
      const searchBar  = document.getElementById('searchBar');
      const closeBtn   = document.getElementById('closeSearch');
      if (!searchIcon || !searchBar || !closeBtn) return;

      function openSearch(e){
        e?.preventDefault?.();
        searchBar.classList.add('show');
        const input = searchBar.querySelector('input');
        setTimeout(()=> input?.focus(), 10);
      }
      function closeSearch(){
        searchBar.classList.remove('show');
      }

      searchIcon.addEventListener('click', openSearch);
      closeBtn.addEventListener('click', closeSearch);
      document.addEventListener('keydown', (e)=>{
        if (e.key === 'Escape' && searchBar.classList.contains('show')) closeSearch();
      });
    })();
  </script>

  <!-- ===== Shop Drawer script (mobile) — uses [data-shop-trigger] ===== -->
  <script>
    (function ShopDrawer(){
      const header   = document.querySelector('.yonutri-navbar') || document.querySelector('header');
      const drawer   = document.getElementById('shopDrawer');
      const overlay  = document.getElementById('overlay');
      const closeBtn = document.getElementById('closeShopDrawer');
      const openBtns = Array.from(document.querySelectorAll('[data-shop-trigger]'));
      const root     = document.documentElement;
      const TRANS_MS = 320;

      if (!drawer || !overlay) return;

      function placeUnderHeader(){
        const rect = header ? header.getBoundingClientRect() : { bottom: 0 };
        const top  = Math.max(0, rect.bottom) + 8;
        drawer.style.setProperty('--sheet-top', `${Math.round(top)}px`);
      }

      function open(e){
        e?.preventDefault?.();
        if (window.matchMedia('(max-width: 991.98px)').matches) {
          placeUnderHeader();
          drawer.classList.add('open');
          overlay.classList.add('show');
          drawer.setAttribute('aria-hidden','false');
          overlay.setAttribute('aria-hidden','false');
          root.classList.add('modal-open'); document.body.classList.add('modal-open');
          (closeBtn || drawer).focus?.();
        }
      }

      function close(){
        const fallbackOpener = openBtns[0];
        fallbackOpener?.focus?.();

        drawer.classList.remove('open');
        overlay.classList.remove('show');
        root.classList.remove('modal-open'); document.body.classList.remove('modal-open');

        setTimeout(() => {
          drawer.setAttribute('aria-hidden','true');
          overlay.setAttribute('aria-hidden','true');
        }, TRANS_MS);
      }

      openBtns.forEach(btn => btn?.addEventListener('click', open));
      closeBtn?.addEventListener('click', close);
      overlay?.addEventListener('click', close);
      window.addEventListener('keydown', e => { if (e.key === 'Escape' && drawer.classList.contains('open')) close(); });

      ['resize','orientationchange','scroll'].forEach(evt => {
        window.addEventListener(evt, () => { if (drawer.classList.contains('open')) placeUnderHeader(); });
      });

      drawer.addEventListener('click', (e) => {
        const a = e.target.closest('a.category-item');
        if (!a) return;
        const href = (a.getAttribute('href')||'').trim();
        if (href.startsWith('#')) close();
      });
    })();
  </script>

  <!-- ===== Desktop Shop Panel controller — NO auto-scroll, TOGGLE on trigger ===== -->
  <script>
    (function DesktopShopPanel(){
      const mqDesktop = window.matchMedia('(min-width: 992px)'); // Bootstrap lg
      const header    = document.querySelector('.yonutri-navbar');
      const panel     = document.getElementById('shopPanel');
      const overlay   = document.getElementById('overlay');
      const triggers  = document.querySelectorAll('[data-shop-trigger]');

      if (!panel || !overlay) return;

      function placePanel(){
        const h = header?.getBoundingClientRect().height || 105;
        panel.style.top = h + 'px';           // offsets from CURRENT viewport top
      }

      function openPanel(e){
        e?.preventDefault?.();
        if (!mqDesktop.matches) return;
        placePanel();
        panel.classList.add('show');
        panel.setAttribute('aria-hidden','false');
        overlay.classList.add('show');
      }

      function closePanel(){
        panel.classList.remove('show');
        panel.setAttribute('aria-hidden','true');
        overlay.classList.remove('show');
      }

      function togglePanel(e){
        if (!mqDesktop.matches) return;           // desktop only
        if (panel.classList.contains('show')) {
          closePanel();
        } else {
          openPanel(e);
        }
      }

      // Toggle on header/footer SHOP clicks (desktop)
      triggers.forEach(btn => {
        btn.addEventListener('click', function(e){
          togglePanel(e);
        }, true);
      });

      overlay.addEventListener('click', closePanel);
      window.addEventListener('keydown', e => { if (e.key === 'Escape') closePanel(); });

      ['resize','scroll','orientationchange'].forEach(evt => {
        window.addEventListener(evt, () => { if (panel.classList.contains('show')) placePanel(); });
      });

      mqDesktop.addEventListener?.('change', () => {
        closePanel();
        document.getElementById('shopDrawer')?.classList.remove('open');
        overlay.classList.remove('show');
        document.documentElement.classList.remove('modal-open');
        document.body.classList.remove('modal-open');
      });
    })();
  </script>

  <!-- ===== Hide header on scroll down, show on scroll up ===== -->
  <script>
    (function HideHeaderOnScroll(){
      const header = document.querySelector('.yonutri-navbar');
      if (!header) return;

      let lastY = window.pageYOffset || document.documentElement.scrollTop || 0;
      let ticking = false;

      function onScroll(){
        const y = window.pageYOffset || document.documentElement.scrollTop || 0;

        if (y < 10){
          header.classList.remove('nav-hide');
        } else {
          if (y > lastY && y > 80){
            header.classList.add('nav-hide');
          } else {
            header.classList.remove('nav-hide');
          }
        }

        lastY = y;
        ticking = false;
      }

      window.addEventListener('scroll', () => {
        if (!ticking){
          window.requestAnimationFrame(onScroll);
          ticking = true;
        }
      }, { passive: true });

      const overlay = document.getElementById('overlay');
      overlay?.addEventListener('click', () => header.classList.remove('nav-hide'));
      window.addEventListener('keydown', (e) => { if (e.key === 'Escape') header.classList.remove('nav-hide'); });
    })();
  </script>

  <script>
(function sharedCart(){
  const CART_KEY   = 'yonutri_cart_v1';
  const COUPON_KEY = 'yonutri_coupon_v1';

  const drawer  = document.getElementById('cart');
  const overlay = document.getElementById('overlay');
  const closeBtn= document.getElementById('closeCart');
  const cartIcon= document.getElementById('cartIcon');
  const itemsEl = document.getElementById('cartItems');
  const titleEl = document.getElementById('cartTitle');
  const totalEl = document.getElementById('totalRupees');
  const dynamicCouponsListEl = document.getElementById('dynamicCouponsList');

  let availableCoupons = []; // To store fetched coupons

  if (!drawer || !overlay || !itemsEl || !titleEl || !totalEl || !dynamicCouponsListEl) return;

  // Badge on header icon
  (function ensureBadge(){
    const iconEl = cartIcon.querySelector('.header-icon') || cartIcon;
    iconEl.style.position = 'relative';
    let badge = document.getElementById('cartBadge');
    if (!badge){
      badge = document.createElement('span');
      badge.id = 'cartBadge';
      badge.className = 'cart-badge';
      badge.hidden = true;
      badge.textContent = '0';
      iconEl.appendChild(badge);
    }
    window.updateCartBadge = function(count){
      const n = Math.max(0, Number(count) || 0);
      badge.hidden = n === 0;
      badge.textContent = n > 99 ? '99+' : String(n);
      badge.classList.remove('pop'); void badge.offsetWidth; badge.classList.add('pop');
    };
  })();

  const INR = (n) => '₹' + Math.max(0, Math.round(Number(n)||0)).toLocaleString('en-IN');
  const keyOf = (p) => p.key ? p.key : ((p.sku||'') + '|' + (p.grams||''));

  const loadCart = () => { try { return new Map(JSON.parse(localStorage.getItem(CART_KEY)||'[]')); } catch { return new Map(); } };
  const saveCart = (map) => { try { localStorage.setItem(CART_KEY, JSON.stringify([...map])); } catch {} };

  const getAppliedCoupon = () => { try { return JSON.parse(localStorage.getItem(COUPON_KEY)||'null'); } catch { return null; } };
  const setAppliedCoupon = (c) => { if (!c) localStorage.removeItem(COUPON_KEY); else localStorage.setItem(COUPON_KEY, JSON.stringify(c)); };

  function computeDiscount(subtotal, coupon){
    if (!coupon) return 0;
    if (subtotal < (coupon.min_amount||0)) return 0; // Use min_amount from fetched coupon
    let d = coupon.discount_type === 'percentage' ? subtotal * (coupon.discount_value/100) : coupon.discount_value;
    return Math.min(Math.round(d), subtotal);
  }

  function openCart(){ drawer.classList.add('active'); overlay.classList.add('active'); }
  function closeCart(){ drawer.classList.remove('active'); overlay.classList.remove('active'); }
  overlay.addEventListener('click', closeCart);
  closeBtn?.addEventListener('click', closeCart);
  cartIcon?.addEventListener('click', e => { e.preventDefault(); openCart(); });

  // Expose simple helpers so the offers section can interact with the cart
  window.getCartQty = function(key){
    const cart = loadCart();
    const it = cart.get(String(key));
    return it ? (it.qty||0) : 0;
  };

  window.addToCart = function(p){
    const cart = loadCart();
    const key = keyOf(p);
    const cur = cart.get(key) || {...p, qty:0};
    cur.qty += 1;
    cart.set(key, cur);
    saveCart(cart);
    render();
    openCart(); // open drawer after add
  };

  // change qty by absolute value; if ensureObj provided and item missing, create it
  window.changeCartQty = function(key, qty, ensureObj){
    const cart = loadCart();
    let it = cart.get(key);
    if (!it && typeof ensureObj === 'function'){
      it = {...ensureObj(), qty:0};
    }
    if (!it) return; // nothing to change
    if (qty <= 0) cart.delete(key);
    else { it.qty = qty; cart.set(key, it); }
    saveCart(cart);
    render();
  };

  // Fetch and render coupons dynamically
  async function fetchAndRenderCoupons() {
    try {
      const response = await fetch(`${API}/api/coupons`);
      if (!response.ok) {
        console.error('Failed to fetch coupons:', response.statusText);
        
        return;
      }
      availableCoupons = await response.json();
      console.log('Fetched coupons:', availableCoupons);
      renderCoupons();
    } catch (error) {
      console.error('Error fetching coupons:', error);
    }
  }

  function renderCoupons() {
    dynamicCouponsListEl.innerHTML = '';
    const subtotal = calculateSubtotal(); // Get current subtotal
    const appliedCoupon = getAppliedCoupon();

    if (availableCoupons.length === 0) {
      dynamicCouponsListEl.innerHTML = '<p style="text-align:center; color:#666;">No coupons available at the moment.</p>';
      return;
    }

    availableCoupons.forEach(coupon => {
      const isApplied = appliedCoupon && appliedCoupon.code === coupon.code;
      const meetsMinAmount = subtotal >= (coupon.min_amount || 0);
      const discountPreview = computeDiscount(subtotal, coupon);

      dynamicCouponsListEl.insertAdjacentHTML('beforeend', `
        <div class="coupon-band" data-coupon-id="${coupon.id}" style="${isApplied ? 'display:none;' : 'display:flex;'}">
          <div class="coupon-left">
            <div class="icon"><i class="fa-solid fa-badge-percent"></i></div>
            <div class="coupon-text">
              <span class="coupon-main">${coupon.code}</span>
              <span class="coupon-sub">${coupon.description || ''}</span>
              <span class="coupon-sub">Save ${INR(discountPreview)}</span>
            </div>
          </div>
          <button class="coupon-apply" type="button" data-coupon-id="${coupon.id}" ${!meetsMinAmount || isApplied ? 'disabled' : ''}>Apply</button>
        </div>
      `);
    });

    // Update applied coupon display
    const appliedRow = document.getElementById('appliedRow');
    const appliedSavingsEl = document.getElementById('appliedSavings');
    const discount = computeDiscount(subtotal, appliedCoupon);

    if (appliedCoupon && discount > 0) {
      appliedRow.style.display = 'flex';
      if (appliedSavingsEl) appliedSavingsEl.textContent = INR(discount);
    } else {
      appliedRow.style.display = 'none';
      if (appliedCoupon) localStorage.removeItem(COUPON_KEY);
    }
  }

  // Helper to calculate current subtotal
  function calculateSubtotal() {
    const cart = loadCart();
    let subtotal = 0;
    for (const p of cart.values()){
      subtotal += p.qty * (Number(p.price)||0);
    }
    return subtotal;
  }

  // Render cart DOM
  function render(){
    const cart = loadCart();
    itemsEl.innerHTML = '';
    let count = 0, subtotal = 0;

    for (const p of cart.values()){
      count += p.qty;
      subtotal += p.qty * (Number(p.price)||0);
      const key = keyOf(p);
      const variantLabel = /^\d+$/.test(String(p.grams)) ? `${p.grams} g` : (p.grams||'');
      itemsEl.insertAdjacentHTML('beforeend', `
        <div class="c-row" data-key="${key}">
          <img class="c-thumb" src="${p.img}" alt="">
          <div class="c-mid">
            <h3 class="c-title">${p.title}</h3>
            <div class="c-sub">${variantLabel}</div>
            <div class="qty ${p.qty===1 ? 'is-single' : ''}">
              <button class="dec" type="button" aria-label="Decrease">−</button>
              <span class="count">${p.qty}</span>
              <button class="inc" type="button" aria-label="Increase">+</button>
            </div>
          </div>
          <div class="c-right">
            <div class="c-prices"><div class="c-price">${INR(p.price)}</div></div>
            <button class="c-trash" title="Remove"><i class="fa-solid fa-trash"></i></button>
          </div>
        </div>
      `);
    }

    // Re-render coupons whenever cart changes to update eligibility/applied status
    renderCoupons();

    const applied = getAppliedCoupon();
    const discount = computeDiscount(subtotal, applied);

    titleEl.textContent = `Your cart · ${count} ${count===1?'item':'items'}`;
    totalEl.textContent  = INR(subtotal - discount);

    if (window.updateCartBadge) window.updateCartBadge(count);
    // Let other widgets (offers) react
    window.dispatchEvent(new CustomEvent('cart-updated',{detail:{cart:[...loadCart().values()], subtotal, discount}}));
  }

  // Item row interactions
  itemsEl.addEventListener('click', e=>{
    const row = e.target.closest('.c-row'); if(!row) return;
    const key = row.dataset.key;
    const cart = loadCart();
    const it = cart.get(key);
    if (!it) return;

    if (e.target.classList.contains('inc'))      it.qty += 1;
    else if (e.target.classList.contains('dec')) it.qty -= 1;
    else if (e.target.closest('.c-trash'))       it.qty = 0;
    else return;

    if (it.qty <= 0) cart.delete(key); else cart.set(key, it);
    saveCart(cart);
    render();
  });

  // Event listener for dynamically added coupon apply buttons
  dynamicCouponsListEl.addEventListener('click', (e) => {
    if (e.target.classList.contains('coupon-apply')) {
      const couponId = e.target.dataset.couponId;
      const selectedCoupon = availableCoupons.find(c => String(c.id) === couponId);
      if (selectedCoupon) {
        setAppliedCoupon(selectedCoupon);
        render();
      }
    }
  });

  document.getElementById('removeCouponBtn')?.addEventListener('click', () => {
    setAppliedCoupon(null); render();
  });

  // live sync
  window.addEventListener('storage', (e) => {
    if (e.key === CART_KEY || e.key === COUPON_KEY) render();
  });

  // Initial fetch of coupons
  fetchAndRenderCoupons();
  render(); // Initial render of cart and coupons
})();
</script>
<script>
(() => {
  const list = document.getElementById('offerList');
  if (!list) return;
  const INR = n => '₹' + Number(n).toLocaleString('en-IN');

  // Add or edit your offers here
  const OFFERS = [
    { sku:'minis4g', title:'Creamy Peanut Butter dark chocolate', img:'images/CREAMY_Dark_Chocolate-removebg-preview.png', mrp:480, price:432,   grams:'Offer' },
    { sku:'powerup', title:'Creamy Peanut Butter dates',   img:'images/CREAMY_Dates-removebg-preview.png',  mrp:399, price:359.1, grams:'Offer' },
  ];

  const keyOf = o => `${o.sku}|${o.grams||''}`;
  const qtyOf = o => (window.getCartQty ? window.getCartQty(keyOf(o)) : 0);

  const cardHTML = (o) => {
    const q = qtyOf(o);
    return `
      <div class="offer-card" data-sku="${o.sku}">
        <img class="offer-thumb" src="${o.img}" alt="">
        <div class="offer-title">${o.title}</div>
        <div class="offer-price">
          ${o.mrp ? `<span class="offer-old">${INR(o.mrp)}</span>` : ``}
          <span>${INR(o.price)}</span>
        </div>
        ${
          q > 0
          ? `<div class="offer-qty">
               <button class="dec" type="button">−</button>
               <span class="count">${q}</span>
               <button class="inc" type="button">+</button>
             </div>`
          : `<button class="offer-cta" type="button">+ ADD</button>`
        }
      </div>
    `;
  };

  const render = () => { list.innerHTML = OFFERS.map(cardHTML).join(''); };

  list.addEventListener('click', e => {
    const card  = e.target.closest('.offer-card'); if (!card) return;
    const offer = OFFERS.find(o => o.sku === card.dataset.sku); if (!offer) return;
    const key   = keyOf(offer);
    const cur   = qtyOf(offer);

    if (e.target.classList.contains('offer-cta')) {
      window.addToCart && window.addToCart({
        sku: offer.sku, grams: offer.grams || 'Special Offer',
        title: offer.title, price: offer.price, img: offer.img
      });
    } else if (e.target.classList.contains('inc')) {
      window.changeCartQty && window.changeCartQty(key, cur + 1, () => ({
        sku: offer.sku, grams: offer.grams || 'Special Offer',
        title: offer.title, price: offer.price, img: offer.img
      }));
    } else if (e.target.classList.contains('dec')) {
      window.changeCartQty && window.changeCartQty(key, cur - 1);
    }

    render();
  });

  window.addEventListener('cart-updated', render);
  render();
})();
</script>

</body>
<script>
  document.addEventListener('DOMContentLoaded', function() {
      const userIcon = document.getElementById('userIcon');
      const token = localStorage.getItem('token');
      const userName = localStorage.getItem('userName');
  
      function logout() {
          localStorage.removeItem('token');
          localStorage.removeItem('userName');
          localStorage.removeItem('isAdmin');
          window.location.href = 'index.html';
      }
  
      if (userIcon) {
          if (token && userName) {
              // User is logged in
              const userFirstName = userName.split(' ')[0];
              userIcon.innerHTML = `<i class="fa-solid fa-user"></i> ${userFirstName}`;
              userIcon.href = 'login.html'; // Link to account page
  
              let logoutLink = document.getElementById('logoutLink');
              if (!logoutLink) {
                  logoutLink = document.createElement('a');
                  logoutLink.id = 'logoutLink';
                  logoutLink.href = '#';
                  logoutLink.textContent = 'Logout';
                  logoutLink.style.cssText = 'margin-left: 1rem; cursor: pointer; color: #fff; text-decoration: none;';
                  userIcon.insertAdjacentElement('afterend', logoutLink);
              }
              
              logoutLink.addEventListener('click', (e) => {
                  e.preventDefault();
                  logout();
              });
          } else {
              // User is logged out
              userIcon.innerHTML = `<i class="fa-solid fa-user"></i>`;
              userIcon.href = 'login.html';
              document.getElementById('logoutLink')?.remove();
          }
      }

      // On login.html, decide which form to show
      if (token && userName) {
          if (typeof showAccountPage === 'function') {
              showAccountPage();
          }
      }
  });
  </script>
  <script>
    /* -------- Cart badge -------- */
(() => {
  const cartLink = document.getElementById('cartIcon');
  if (!cartLink) return;
  const iconEl = cartLink.querySelector('.header-icon') || cartLink;
  iconEl.style.position = 'relative';

  const style = document.createElement('style');
  style.textContent = `
    .cart-badge{position:absolute;top:-6px;right:-8px;min-width:18px;height:18px;padding:0 5px;border-radius:9999px;display:inline-flex;align-items:center;justify-content:center;background:#0a7f00;color:#fff;font-weight:900;font-size:11px;line-height:18px;box-shadow:0 1px 0 rgba(0,0,0,.15)}
    .cart-badge[hidden]{display:none !important}
    @keyframes cb-pop{0%{transform:scale(.6)}50%{transform:scale(1.15)}100%{transform:scale(1)}}
    .cart-badge.pop{animation:cb-pop .28s ease}
  `;
  document.head.appendChild(style);

  let badge = document.getElementById('cartBadge');
  if (!badge) {
    badge = document.createElement('span');
    badge.id = 'cartBadge';
    badge.className = 'cart-badge';
    badge.hidden = true;
    badge.textContent = '0';
    iconEl.appendChild(badge);
  }

  window.updateCartBadge = function(count){
    const n = Math.max(0, Number(count) || 0);
    badge.hidden = n === 0;
    badge.textContent = n > 99 ? '99+' : String(n);
    badge.classList.remove('pop'); void badge.offsetWidth; badge.classList.add('pop');
  };

  window.addEventListener('cart-updated', (e) => {
    const items = e.detail?.cart || [];
    const total = items.reduce((s, it) => s + (Number(it.qty) || 0), 0);
    window.updateCartBadge(total);
  });

  window.updateCartBadge(0);
})();

    /* -------- Cart drawer with coupon engine (PERSISTENT) -------- */
(() => {
    if (window._yonutriCartInit) return; window._yonutriCartInit = true;
    const drawer = document.getElementById('cart'), overlay = document.getElementById('overlay'), closeBtn = document.getElementById('closeCart'), cartIcon = document.getElementById('cartIcon'), itemsEl = document.getElementById('cartItems'), titleEl = document.getElementById('cartTitle'), totalEl = document.getElementById('totalRupees');
    if (!drawer || !overlay || !itemsEl || !titleEl || !totalEl) return;
    // Updated INR function to remove trailing .00 and format price without decimals
    const INR = n => {
      const num = Number(n);
      if (isNaN(num)) return '₹0';
      // Format without decimals
      return '₹' + Math.floor(num).toLocaleString('en-IN');
    };

    const CART_KEY = 'yonutri_cart_v1';
    const COUPON_KEY = 'yonutri_coupon_v1';

    const loadCart = () => { try { return new Map(JSON.parse(localStorage.getItem(CART_KEY) || '[]')); } catch { return new Map(); } };
    const cart = loadCart(); const saveCart = () => { try { localStorage.setItem(CART_KEY, JSON.stringify([...cart])); } catch { } };

    const applyBtn = document.getElementById('applyCouponBtn');
    const removeBtn = document.getElementById('removeCouponBtn');
    const couponInput = document.getElementById('couponInput');
    const couponMessage = document.getElementById('couponMessage');
    const appliedRow = document.getElementById('appliedRow');
    const appliedSavings = document.getElementById('appliedSavings');
    const couponScroller = document.getElementById('couponScroller');

    let allCoupons = [];

    async function fetchCoupons() {
        try {
            const response = await fetch(`${API}/api/coupons`);
            if (!response.ok) throw new Error('Failed to fetch coupons');
            allCoupons = await response.json();
            console.log('Fetched coupons:', allCoupons);
            renderCouponScroller();
        } catch (error) {
            console.error('Error fetching coupons:', error);
        }
    }

    function renderCouponScroller() {
        if (!couponScroller) return;
        couponScroller.innerHTML = allCoupons.map(c => `
            <div class="coupon-card" data-code="${c.code}" style="border: 1px solid #ccc; border-radius: 8px; padding: 10px; cursor: pointer; min-width: 150px;">
                <div style="font-weight: bold;">${c.code}</div>
                <div style="font-size: 12px;">${c.discount_type === 'percent' ? c.discount_amount + '%' : '₹' + c.discount_amount} off</div>
                <div style="font-size: 10px; color: #666;">Min: ₹${c.minimum_amount || 0}</div>
            </div>
        `).join('');
    }

    couponScroller?.addEventListener('click', e => {
        const card = e.target.closest('.coupon-card');
        if (card) {
            couponInput.value = card.dataset.code;
            applyBtn.click();
        }
    });

    function getApplied() { try { return JSON.parse(localStorage.getItem(COUPON_KEY) || 'null'); } catch { return null; } }
    function setApplied(c) { if (!c) localStorage.removeItem(COUPON_KEY); else localStorage.setItem(COUPON_KEY, JSON.stringify(c)); }
    function calcDiscount(subtotal, c) { if (!c) return 0; if (subtotal < (c.minimum_amount || 0)) return 0; let d = c.discount_type === 'percent' ? subtotal * (c.discount_amount / 100) : c.discount_amount; return Math.min(Math.round(d), subtotal); }

    function openCart() { drawer.classList.add('active'); overlay.classList.add('active'); fetchCoupons(); }
    function closeCart() { drawer.classList.remove('active'); overlay.classList.remove('active'); }
    overlay.addEventListener('click', closeCart); closeBtn?.addEventListener('click', closeCart);
    cartIcon?.addEventListener('click', e => { e.preventDefault(); openCart(); });

    applyBtn?.addEventListener('click', () => {
        const enteredCode = couponInput.value.toUpperCase().trim();
        if (!enteredCode) {
            couponMessage.textContent = "Please enter a coupon code.";
            return;
        }

        const coupon = allCoupons.find(c => c.code === enteredCode);

        if (coupon) {
            setApplied(coupon);
            couponMessage.textContent = "";
            render();
        } else {
            couponMessage.textContent = "Invalid coupon code.";
            setApplied(null);
            render();
        }
    });

    removeBtn?.addEventListener('click', () => { setApplied(null); render(); });

    function render() {
        saveCart(); itemsEl.innerHTML = ''; let count = 0, subtotal = 0;

        for (const p of cart.values()) {
            count += p.qty;
            subtotal += p.qty * p.price;
            const variantLabel = p.grams || '';
            itemsEl.insertAdjacentHTML('beforeend', `
          <div class="c-row" data-key="${p.key}">
            <img class="c-thumb" src="${p.img}" alt="">
            <div class="c-mid">
              <h3 class="c-title">${p.title}</h3>
              <div class="c-sub">${variantLabel}</div>
              <div class="qty ${p.qty === 1 ? 'is-single' : ''}">
                <button class="dec" type="button">−</button>
                <span class="count">${p.qty}</span>
                <button class="inc" type="button">+</button>
              </div>
            </div>
            <div class="c-right">
              <div class="c-prices">
                <div class="c-price">${INR(p.price)}</div>
              </div>
              <button class="c-trash" title="Remove"><i class="fa-solid fa-trash"></i></button>
            </div>
          </div>`);
        }

        const applied = getApplied();
        const discount = calcDiscount(subtotal, applied);

        if (applied && discount > 0) {
            appliedRow.style.display = 'flex';
            if (appliedSavings) appliedSavings.textContent = INR(discount);
            couponInput.value = applied.code;
            couponInput.disabled = true;
            applyBtn.style.display = 'none';
            removeBtn.style.display = 'inline-block';
            couponMessage.textContent = "";
        } else {
            appliedRow.style.display = 'none';
            if(applied && discount === 0 && subtotal < (applied.minimum_amount || 0)) {
                couponMessage.textContent = `You need to spend ₹${applied.minimum_amount} to use this coupon.`;
                setApplied(null); // Remove invalid coupon
            }
            couponInput.value = "";
            couponInput.disabled = false;
            applyBtn.style.display = 'inline-block';
            removeBtn.style.display = 'none';
        }


        titleEl.textContent = `Your cart · ${count} ${count === 1 ? 'item' : 'items'}`;
        totalEl.textContent = INR(subtotal - discount);

        if (window.updateCartBadge) window.updateCartBadge(count);
        window.dispatchEvent(new CustomEvent('cart-updated', { detail: { cart: [...cart.values()], subtotal, discount } }));
    }

    itemsEl.addEventListener('click', e => {
        const row = e.target.closest('.c-row'); if (!row) return;
        const key = row.dataset.key; const it = cart.get(key); if (!it) return;
        if (e.target.classList.contains('inc')) it.qty += 1;
        else if (e.target.classList.contains('dec')) it.qty -= 1;
        else if (e.target.closest('.c-trash')) it.qty = 0;
        else return;
        if (it.qty <= 0) cart.delete(key);
        render();
    });

    window.addToCart = function (item, qty = 1) {
        const key = (item.sku || '') + '|' + (item.grams || ''); const exist = cart.get(key);
        if (exist) exist.qty += qty; else cart.set(key, { ...item, key, qty: Math.max(1, qty) });
        render(); openCart();
    };
    window.changeCartQty = function (key, newQty, itemFactory) {
        if (newQty <= 0) { cart.delete(key); render(); return; }
        let it = cart.get(key);
        if (!it) {
            if (typeof itemFactory === 'function') { it = itemFactory(); if (!it) return; it.key = key; it.qty = 0; cart.set(key, it); }
            else return;
        }
        it.qty = newQty; render();
    };
    window.getCartQty = function (key) { const it = cart.get(key); return it ? it.qty : 0; };

    window.addEventListener('storage', (e) => {
        if (e.key === 'yonutri_cart_v1') { try { const arr = JSON.parse(e.newValue || '[]'); cart.clear(); arr.forEach(([k, v]) => cart.set(k, v)); } catch { } render(); }
        if (e.key === 'yonutri_coupon_v1') { render(); }
    });

    render();
    fetchCoupons();
  })();

  </script>

  <script>
(() => {
  const header   = document.querySelector('.yonutri-navbar') || document.querySelector('header');
  const drawer   = document.getElementById('shopDrawer');
  const openBtn  = document.getElementById('hamburgerBtn');
  const closeBtn = document.getElementById('closeShopDrawer');
  const overlay  = document.getElementById('overlay');
  const TRANS_MS = 320;

  function placeSheetUnderHeader(){
    const rect = header ? header.getBoundingClientRect() : { bottom: 0 };
    const top  = Math.max(0, rect.bottom) + 8; // 8px gap
    drawer.style.setProperty('--sheet-top', top + 'px');
  }

  function open() {
    placeSheetUnderHeader();
    drawer.classList.add('open');
    overlay.classList.add('show');
    drawer.setAttribute('aria-hidden','false');
    overlay.setAttribute('aria-hidden','false');
    document.documentElement.classList.add('modal-open');
    document.body.classList.add('modal-open');
    (closeBtn || drawer).focus();
    openBtn?.setAttribute('aria-expanded','true');
  }

  function close() {
    openBtn?.focus();

    drawer.classList.remove('open');
    overlay.classList.remove('show');
    openBtn?.setAttribute('aria-expanded','false');
    document.documentElement.classList.remove('modal-open');
    document.body.classList.remove('modal-open');

    setTimeout(() => {
      drawer.setAttribute('aria-hidden','true');
      overlay.setAttribute('aria-hidden','true');
    }, TRANS_MS);
  }

  openBtn?.addEventListener('click', open);
  closeBtn?.addEventListener('click', close);
  overlay?.addEventListener('click', close);
  window.addEventListener('keydown', e => { if (e.key === 'Escape' && drawer.classList.contains('open')) close(); });

  ['resize','orientationchange','scroll'].forEach(evt => window.addEventListener(evt, () => {
    if (drawer.classList.contains('open')) placeSheetUnderHeader();
  }));

  drawer.addEventListener('click', (e) => {
    const a = e.target.closest('a.category-item');
    if (a && (a.getAttribute('href')||'').startsWith('#')) close();
  });
})();
</script>
 <!-- Include product loading script -->
  <script src="script.js"></script>
</body>
</html>